<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Anniversary Puzzle</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #111;
      color: #fdf2f8;
      font-family: system-ui, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .frame {
      background: #0b0b10;
      border-radius: 24px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.05),
                  0 20px 60px rgba(0,0,0,0.9);
      padding: 32px 40px;
      max-width: 960px;
      width: 100%;
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 32px;
    }

    .left {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 16px;
    }

    .title { font-size: 28px; font-weight: 700; }
    .subtitle { font-size: 14px; opacity: 0.9; line-height: 1.5; }

    .play-btn {
      margin-top: 12px; padding: 10px 24px;
      border-radius: 999px; border: none;
      cursor: pointer; font-weight: 600; font-size: 14px;
      letter-spacing: 0.08em; text-transform: uppercase;
      background: radial-gradient(circle at 0 0, #fb7185, #db2777);
      color: #fff;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06),
                  0 8px 24px rgba(248,113,113,0.5);
    }

    .right {
      background: radial-gradient(circle at 0 0, rgba(248,113,113,0.35), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(147,197,253,0.35), transparent 60%),
                  #050509;
      border-radius: 20px; position: relative; padding: 16px;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
    }

    canvas {
      border-radius: 16px; background: #020617;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.03),
                  0 24px 60px rgba(15,23,42,0.95);
      max-width: 100%;
    }

    .status {
      position: absolute; bottom: 14px; left: 16px; right: 16px;
      display: flex; justify-content: space-between;
      font-size: 11px; letter-spacing: 0.08em; opacity: 0.85;
      text-transform: uppercase;
    }

    .status-dot {
      width: 7px; height: 7px; border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34,197,94,0.18);
    }
    .status-dot.done {
      background: #fb7185;
      box-shadow: 0 0 0 5px rgba(248,113,113,0.24);
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="left">
      <div style="font-size:11px;opacity:.7;letter-spacing:.14em;text-transform:uppercase;">
        Happy Anniversary, my silly bun bun üíï
      </div>
      <div class="title">A tiny puzzle for a huge love</div>

      <div class="subtitle">
        Solve this little jigsaw to reveal one of my favourite photos of us.
      </div>

      <button id="playButton" class="play-btn">Play</button>

      <div class="how-to" style="font-size:12px;opacity:.9;line-height:1.6;margin-top:10px;">
        ‚Ä¢ Click Play to start <br>
        ‚Ä¢ Drag pieces to move them<br>
        ‚Ä¢ They snap when close to correct position
      </div>
    </div>

    <div class="right">
      <canvas id="puzzleCanvas" width="480" height="360"></canvas>
      <div class="status">
        <span><span class="status-dot" id="statusDot"></span>
        <span id="statusText">Waiting to play</span></span>
        <span id="movesText">Moves: 0</span>
      </div>
    </div>
  </div>

  <script>
    const PUZZLE_ROWS = 6;
    const PUZZLE_COLS = 6;
    
    /* ‚úÖ Embedded Base64 Image (your uploaded picture) */
    const IMAGE_SRC = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiQAAAErCAIAAABhLw9vAAAQAElEQVR4Aez999c...yud0ehfmf1J54x29kgiBRIg4QTCdL/+8c91VZUZ+4nMuve5j3tNd4NGQrzfioqM";

    const canvas = document.getElementById("puzzleCanvas");
    const ctx = canvas.getContext("2d");
    const playButton = document.getElementById("playButton");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const movesText = document.getElementById("movesText");

    let img = new Image();
    let pieces = [];
    let pieceWidth, pieceHeight;
    let draggingPiece = null;
    let offsetX = 0, offsetY = 0;
    let moves = 0, completed = false;

    function setStatus(state) {
      statusDot.classList.remove("done");
      if (state === "idle") statusText.textContent = "Waiting to play";
      if (state === "playing") statusText.textContent = "Solving together";
      if (state === "done") {
        statusText.textContent = "Puzzle complete ‚ù§Ô∏è";
        statusDot.classList.add("done");
      }
    }

    function initPieces() {
      pieces = [];
      pieceWidth = canvas.width / PUZZLE_COLS;
      pieceHeight = canvas.height / PUZZLE_ROWS;

      for (let r = 0; r < PUZZLE_ROWS; r++) {
        for (let c = 0; c < PUZZLE_COLS; c++) {
          pieces.push({
            correctX: c * pieceWidth,
            correctY: r * pieceHeight,
            x: c * pieceWidth,
            y: r * pieceHeight
          });
        }
      }

      for (let i = pieces.length - 1; i > 0; i--) {
        const j = Math.random() * (i + 1) | 0;
        [pieces[i].x, pieces[j].x] = [pieces[j].x, pieces[i].x];
        [pieces[i].y, pieces[j].y] = [pieces[j].y, pieces[i].y];
      }
    }

    function drawPuzzle() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (const p of pieces) {
        ctx.drawImage(img, p.correctX, p.correctY, pieceWidth, pieceHeight,
                           p.x, p.y, pieceWidth, pieceHeight);
      }
    }

    function getPieceAt(x,y) {
      return pieces.slice().reverse().find(p =>
        x>=p.x && x<=p.x+pieceWidth && y>=p.y && y<=p.y+pieceHeight
      ) || null;
    }

    function snapIfClose(piece) {
      const dx = Math.abs(piece.x - piece.correctX);
      const dy = Math.abs(piece.y - piece.correctY);
      const th = Math.min(pieceWidth,pieceHeight)*0.18;
      if (dx<th && dy<th) {
        piece.x = piece.correctX;
        piece.y = piece.correctY;
        return true;
      }
      return false;
    }

    function checkCompleted() {
      return pieces.every(p => p.x === p.correctX && p.y === p.correctY);
    }

    canvas.onmousedown = e => {
      if (completed) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left, y = e.clientY - rect.top;
      const p = getPieceAt(x,y);
      if (!p) return;
      draggingPiece = p;
      offsetX = x - p.x; offsetY = y - p.y;
    };

    canvas.onmousemove = e => {
      if (!draggingPiece) return;
      const rect = canvas.getBoundingClientRect();
      draggingPiece.x = e.clientX - rect.left - offsetX;
      draggingPiece.y = e.clientY - rect.top - offsetY;
      drawPuzzle();
    };

    canvas.onmouseup = () => {
      if (!draggingPiece) return;
      moves++;
      movesText.textContent = "Moves: " + moves;
      snapIfClose(draggingPiece);
      drawPuzzle();
      if (checkCompleted()) { completed = true; setStatus("done"); }
      draggingPiece = null;
    };

    function startPuzzle() {
      completed = false;
      moves = 0;
      movesText.textContent = "Moves: 0";
      setStatus("playing");
      initPieces();
      drawPuzzle();
    }

    playButton.onclick = startPuzzle;

    img.onload = () => {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      setStatus("idle");
    };

    img.src = IMAGE_SRC;
  </script>
</body>
</html>
